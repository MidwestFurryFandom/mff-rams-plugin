{% extends "uber/templates/forms/attendee/badge_extras.html" %}

{% block x_data %}
{{ super() }}
has_restrictions: {{ badge_extras.dietary_restrictions.data|boolean|tojson }},
get showDietaryRestrictions() { return {{ [c.STAFF_BADGE, c.SPONSOR_BADGE, c.SHINY_BADGE]|tojson }}.includes(this.badge_type) || this.ribbons.includes({{ c.STAFF_RIBBON|tojson }}) },
get mffShirtSize() { return this.shirtSize || this.badge_type == {{ c.SPONSOR_BADGE|tojson }} || this.badge_type == {{ c.SHINY_BADGE|tojson }} },
{% endblock %}

{% block badge_type %}
{{ badge_extras.attendance_type(id=id_upgrade_prepend ~ "attendance_type") }}

{% if c.PRESELL_ONE_DAYS and (not receipt or upgrade_modal and attendee.attendance_type == c.SINGLE_DAY) %}
    {{ form_macros.card_select(badge_extras.attendance_type,
                                c.FORMATTED_ATTENDANCE_TYPES,
                                target_field_id=id_upgrade_prepend ~ "attendance_type") }}
    </div>
    <div id="one-day-alert" class="row">
        <div class="col"><div class="alert alert-info mb-0"><em>Please select which day you would like to attend.</em></div></div>
    </div>
    <div class="row g-sm-3 mb-3">
        <input type="hidden" id="badge_type_single" /> {# Dummy attribute to make validation message hideable #}
        {{ form_macros.card_select(badge_extras.badge_type_single,
                                    attendee.available_single_badge_opts, disabled_opts=c.SOLD_OUT_BADGES_SINGLE[1:] if attendee.badge_type in c.SOLD_OUT_BADGES_SINGLE else c.SOLD_OUT_BADGES_SINGLE,
                                    target_field_id=id_upgrade_prepend ~ "badge_type") }}
    </div>
    <script type="text/javascript">
        var switchBadgeTypeOpts = function() {
            let attendanceType = $('#{{ id_upgrade_prepend }}attendance_type').val();
            setVisible($('#badge_type_single-select').parents('.row'), attendanceType == '{{ c.SINGLE_DAY }}');
            setVisible($('#one-day-alert'), attendanceType == '{{ c.SINGLE_DAY }}');
            setVisible($('#badge_type-select').parents('.row'), attendanceType == '{{ c.WEEKEND }}');
        }
        $(function () {
            switchBadgeTypeOpts();
            $('#{{ id_upgrade_prepend }}attendance_type').on('change', switchBadgeTypeOpts);
        })
    </script>
    <div class="row g-sm-3 mb-3">
{% endif %}

{{ super() }}
{% endblock %}

{% block add_ons %}{% endblock %}

{% block perk_info %}
{% if (c.ADDONS_ENABLED and (not receipt or upgrade_modal)) or attendee.gets_any_kind_of_shirt or admin_area %}
    <div class="col-12" x-show="mffShirtSize">{{ form_macros.input(badge_extras.shirt, required_if="mffShirtSize") }}</div>
</div>
<div class="row g-sm-3 mb-3">
{% endif %}
    <div class="col-12" x-show="showDietaryRestrictions">
        {% call form_macros.input(badge_extras.has_restrictions, alpine_model="has_restrictions") %}
        <div x-show="has_restrictions">{{ form_macros.input(badge_extras.dietary_restrictions, required_if="has_restrictions") }}</div>
        {% endcall %}
    </div>
{% endblock %}